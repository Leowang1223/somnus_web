# ğŸ” è³¼ç‰©è»Šå¾¹åº•è¨ºæ–·æŒ‡å—

## ğŸ“ å•é¡Œæè¿°
"Add to Ritual" æŒ‰éˆ•é»æ“Šå¾Œï¼Œè³¼ç‰©è»Šçš„æ•¸é‡å’Œå“é …æ²’æœ‰å¢åŠ æˆ–æ›´æ–°

---

## ğŸ› ï¸ å·²éƒ¨ç½²çš„è¨ºæ–·ç³»çµ±

### **1. å®Œæ•´æ—¥èªŒè¿½è¹¤**
æˆ‘å·²ç¶“åœ¨æ•´å€‹è³¼ç‰©æµç¨‹ä¸­åŠ å…¥äº†**è©³ç´°çš„ emoji æ¨™è¨˜æ—¥èªŒ**ï¼Œè®“æ‚¨å¯ä»¥æ¸…æ¥šçœ‹åˆ°æ¯ä¸€æ­¥ç™¼ç”Ÿäº†ä»€éº¼ã€‚

### **2. å…¨å±€æ¸¬è©¦å‡½æ•¸**
æ‰“é–‹ç€è¦½å™¨æ§åˆ¶å° (F12) å¾Œï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

| å‡½æ•¸ | åŠŸèƒ½ | ç”¨æ³• |
|------|------|------|
| `emergencyAddToCart()` | å¼·åˆ¶åŠ å…¥ç•¶å‰ç”¢å“åˆ°è³¼ç‰©è»Š | ç›´æ¥åœ¨ Console è¼¸å…¥ä¸¦æŒ‰ Enter |
| `toggleCart()` | æ‰‹å‹•é–‹é—œè³¼ç‰©è»ŠæŠ½å±œ | åŒä¸Š |
| `inspectCart()` | æŸ¥çœ‹è³¼ç‰©è»Šå®Œæ•´ç‹€æ…‹ | åŒä¸Š |
| `debugAddToCart()` | å¦ä¸€å€‹å¼·åˆ¶åŠ å…¥å‡½æ•¸ | åŒä¸Š |

---

## ğŸ§ª è¨ºæ–·æ­¥é©Ÿï¼ˆè«‹ä¾åºåŸ·è¡Œï¼‰

### **æ­¥é©Ÿ 1ï¼šé‡æ–°æ•´ç†é é¢**
```
1. æŒ‰ Ctrl + Shift + R (ç¡¬é‡æ–°æ•´ç†)
2. ç¢ºä¿æœ€æ–°ä»£ç¢¼ç”Ÿæ•ˆ
```

### **æ­¥é©Ÿ 2ï¼šæ‰“é–‹æ§åˆ¶å°**
```
1. æŒ‰ F12
2. åˆ‡æ›åˆ° "Console" æ¨™ç±¤
3. æ¸…é™¤èˆŠè¨Šæ¯ (æŒ‰å³ä¸Šè§’çš„ ğŸš« åœ–ç¤º)
```

### **æ­¥é©Ÿ 3ï¼šé€²å…¥ç”¢å“é é¢**
```
1. å°èˆªåˆ°ä»»ä½•ç”¢å“é é¢ (ä¾‹å¦‚ /product/dream-mist)
2. åœ¨æ§åˆ¶å°ä¸­æ‡‰è©²çœ‹åˆ°ï¼š
   â•â•â• PurchaseSection Mounted â•â•â•
   Product context: {...}
   Product ID: [some-id]
   Product Name: [product-name]
   Window function ready: emergencyAddToCart()
```

**â— æª¢æŸ¥é» Aï¼š**
- âœ… å¦‚æœçœ‹åˆ°ä»¥ä¸Šè¨Šæ¯ â†’ çµ„ä»¶æ­£å¸¸è¼‰å…¥
- âŒ å¦‚æœæ²’çœ‹åˆ° â†’ é é¢æ¸²æŸ“æœ‰å•é¡Œï¼Œè«‹æˆªåœ–æ§åˆ¶å°ä¸¦å›å ±

### **æ­¥é©Ÿ 4ï¼šé»æ“Š "Add to Ritual" æŒ‰éˆ•**
```
é»æ“Šç™½è‰²çš„ "Add to Ritual" æŒ‰éˆ•
```

**é æœŸçœ‹åˆ°çš„æ—¥èªŒï¼ˆæŒ‰é †åºï¼‰ï¼š**
```
â­ ADD TO RITUAL CLICKED
Event object: mousedown
Product to add: {id: "xxx", name: "xxx", price: xxx}
Calling addToCart...

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ›’ CART: addToCart called
ğŸ“¦ Product received: {id: "xxx", name: "xxx", ...}
ğŸ”‘ Product ID: xxx
ğŸ“ Product Name: xxx
ğŸ’° Product Price: xxx
ğŸ“Š Current cart state BEFORE: 0 items
ğŸ”„ setItems callback executing...
â• Adding new item to cart
   New cart: [{product: {...}, quantity: 1}]
ğŸšª Setting isOpen to true
âœ“ addToCart completed
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Calling toggleCart...
handleAddToCart completed
```

**â— æª¢æŸ¥é» Bï¼š**
æ ¹æ“šæ‚¨çœ‹åˆ°çš„æ—¥èªŒï¼Œåˆ¤æ–·å•é¡Œå‡ºåœ¨å“ªè£¡ï¼š

#### **æƒ…æ³ 1ï¼šå®Œå…¨æ²’æœ‰ä»»ä½•æ—¥èªŒ**
```
å•é¡Œï¼šæŒ‰éˆ•äº‹ä»¶æ²’æœ‰è§¸ç™¼
åŸå› ï¼šå¯èƒ½æ˜¯ z-index æˆ– pointer-events å•é¡Œ
è§£æ±ºæ–¹æ¡ˆï¼š
1. æª¢æŸ¥æŒ‰éˆ•ä¸Šæ–¹æ˜¯å¦æœ‰å…¶ä»–å…ƒç´ è¦†è“‹
2. åœ¨æ§åˆ¶å°è¼¸å…¥ï¼šemergencyAddToCart()
3. å¦‚æœç·Šæ€¥å‡½æ•¸æœ‰æ•ˆ â†’ ç¢ºèªæ˜¯æŒ‰éˆ•å±¤ç´šå•é¡Œ
```

#### **æƒ…æ³ 2ï¼šçœ‹åˆ° "â­ ADD TO RITUAL CLICKED" ä½†æ²’æœ‰å¾ŒçºŒ**
```
å•é¡Œï¼šaddToCart å‡½æ•¸æ²’æœ‰è¢«èª¿ç”¨
åŸå› ï¼šå¯èƒ½æ˜¯ Context é€£æ¥å•é¡Œ
è§£æ±ºæ–¹æ¡ˆï¼š
1. æª¢æŸ¥æ˜¯å¦æœ‰ç´…è‰²éŒ¯èª¤è¨Šæ¯
2. æˆªåœ–å®Œæ•´æ§åˆ¶å°ä¸¦å›å ±
```

#### **æƒ…æ³ 3ï¼šçœ‹åˆ° "âŒ CART ERROR: Product ID is missing!"**
```
å•é¡Œï¼šç”¢å“è³‡æ–™ä¸å®Œæ•´
åŸå› ï¼šAdmin å¾Œå°ç”¢å“è³‡æ–™ç¼ºå°‘ ID
è§£æ±ºæ–¹æ¡ˆï¼š
1. é€²å…¥ /admin
2. ç·¨è¼¯è©²ç”¢å“
3. ç¢ºä¿ ID æ¬„ä½æœ‰å€¼
4. å„²å­˜å¾Œé‡è©¦
```

#### **æƒ…æ³ 4ï¼šæ‰€æœ‰æ—¥èªŒéƒ½æ­£å¸¸ï¼Œä½†è³¼ç‰©è»Šæ²’æ‰“é–‹**
```
å•é¡Œï¼štoggleCart åŠŸèƒ½ç•°å¸¸
åŸå› ï¼šCart Context ç‹€æ…‹æ›´æ–°å¤±æ•—
è§£æ±ºæ–¹æ¡ˆï¼š
1. åœ¨æ§åˆ¶å°è¼¸å…¥ï¼šinspectCart()
2. æŸ¥çœ‹è¼¸å‡ºçš„ isOpen å€¼
3. å¦‚æœæ˜¯ true ä½†æ²’é¡¯ç¤º â†’ UI æ¸²æŸ“å•é¡Œ
4. æ‰‹å‹•è¼¸å…¥ï¼štoggleCart() çœ‹æ˜¯å¦èƒ½åˆ‡æ›
```

#### **æƒ…æ³ 5ï¼šè³¼ç‰©è»Šæ‰“é–‹äº†ï¼Œä½†è£¡é¢æ˜¯ç©ºçš„**
```
å•é¡Œï¼šitems ç‹€æ…‹æ²’æœ‰æ›´æ–°
åŸå› ï¼šsetItems æ›´æ–°å¤±æ•—æˆ– localStorage å•é¡Œ
è§£æ±ºæ–¹æ¡ˆï¼š
1. åœ¨æ§åˆ¶å°è¼¸å…¥ï¼šinspectCart()
2. æŸ¥çœ‹ "Total items" æ˜¯å¦ç‚º 0
3. æª¢æŸ¥ç€è¦½å™¨çš„ localStorage:
   - F12 â†’ Application â†’ Local Storage
   - æŸ¥æ‰¾ "somnus-cart" éµ
   - çœ‹çœ‹å€¼æ˜¯ä»€éº¼
```

### **æ­¥é©Ÿ 5ï¼šä½¿ç”¨ç·Šæ€¥æ¸¬è©¦**
```
å¦‚æœé»æ“ŠæŒ‰éˆ•æ²’åæ‡‰ï¼Œè«‹å˜—è©¦ï¼š

1. åœ¨æ§åˆ¶å°è¼¸å…¥ï¼šemergencyAddToCart()
2. æŒ‰ Enter
3. è§€å¯Ÿæ—¥èªŒè¼¸å‡º
4. ç„¶å¾Œè¼¸å…¥ï¼šinspectCart()
5. æŸ¥çœ‹è³¼ç‰©è»Šç‹€æ…‹
```

---

## ğŸ“Š é—œéµæ—¥èªŒè§£è®€

### **æ­£å¸¸æµç¨‹æ‡‰è©²çœ‹åˆ°ï¼š**
```
1. â­ ADD TO RITUAL CLICKED          â† æŒ‰éˆ•è¢«é»æ“Š
2. ğŸ›’ CART: addToCart called         â† CartContext æ”¶åˆ°è«‹æ±‚
3. ğŸ“¦ Product received: {...}        â† ç”¢å“è³‡æ–™æ­£ç¢ºå‚³é
4. ğŸ”‘ Product ID: [æœ‰å€¼]             â† ID å­˜åœ¨
5. ğŸ”„ setItems callback executing... â† é–‹å§‹æ›´æ–°ç‹€æ…‹
6. â• Adding new item to cart        â† æ–°å¢é …ç›®ï¼ˆæˆ– âœ… Found existing itemï¼‰
7. ğŸšª Setting isOpen to true         â† æº–å‚™é–‹å•ŸæŠ½å±œ
8. âœ“ addToCart completed             â† å®Œæˆ
```

### **ç•°å¸¸æƒ…æ³ï¼š**
```
âŒ Product ID is missing!            â†’ ç”¢å“è³‡æ–™æœ‰å•é¡Œ
âŒ Cannot find name 'addToCart'      â†’ Context æœªæ­£ç¢ºå°å…¥
âŒ TypeError: xxx is not a function  â†’ å‡½æ•¸ä¸å­˜åœ¨
âŒ æ²’æœ‰ä»»ä½•æ—¥èªŒ                       â†’ äº‹ä»¶æ ¹æœ¬æ²’è§¸ç™¼
```

---

## ğŸ”§ å¸¸è¦‹å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ

### **Q1: é»æ“ŠæŒ‰éˆ•å®Œå…¨æ²’åæ‡‰ï¼Œæ²’æœ‰ä»»ä½• hover æ•ˆæœ**
```
A: æŒ‰éˆ•è¢«è¦†è“‹äº†
è§£æ±ºï¼š
1. F12 â†’ Elements æ¨™ç±¤
2. é»æ“Šå·¦ä¸Šè§’çš„é¸å–å·¥å…· (ç®­é ­åœ–ç¤º)
3. ç§»å‹•åˆ°æŒ‰éˆ•ä¸Š
4. æŸ¥çœ‹ Styles é¢æ¿çš„ z-index å€¼
5. å¦‚æœè¢«å…¶ä»–å…ƒç´ è¦†è“‹ï¼Œæœƒåœ¨ Elements ä¸­çœ‹åˆ°
```

### **Q2: æœ‰ hover æ•ˆæœä½†é»æ“Šæ²’åæ‡‰**
```
A: äº‹ä»¶è™•ç†å™¨æœ‰å•é¡Œ
è§£æ±ºï¼š
1. æª¢æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰ç´…è‰²éŒ¯èª¤
2. ä½¿ç”¨ emergencyAddToCart() æ¸¬è©¦
3. å¦‚æœç·Šæ€¥å‡½æ•¸æœ‰æ•ˆ â†’ ä»£è¡¨é‚è¼¯æ­£å¸¸ï¼Œæ˜¯äº‹ä»¶ç¶å®šå•é¡Œ
```

### **Q3: è³¼ç‰©è»Šæ‰“é–‹äº†ä½†æ˜¯ç©ºçš„**
```
A: ç‹€æ…‹æ›´æ–°å¤±æ•—
è§£æ±ºï¼š
1. inspectCart() æŸ¥çœ‹ç‹€æ…‹
2. æª¢æŸ¥ localStorage (F12 â†’ Application â†’ Local Storage)
3. æ¸…é™¤ somnus-cart éµï¼Œåˆ·æ–°é é¢é‡è©¦
```

### **Q4: æ•¸é‡æ²’æœ‰å¢åŠ ï¼ˆé‡è¤‡é»æ“Šé‚„æ˜¯ 1ï¼‰**
```
A: ID æ¯”å°å¤±æ•—
è§£æ±ºï¼š
1. æŸ¥çœ‹æ—¥èªŒä¸­çš„ Product ID
2. ç¢ºèªæ¯æ¬¡éƒ½æ˜¯åŒä¸€å€‹ ID
3. å¦‚æœ ID æ¯æ¬¡éƒ½è®Š â†’ Admin ç«¯ç”¢å“ ID ç”Ÿæˆæœ‰å•é¡Œ
4. å¦‚æœ ID ç›¸åŒä½†é‚„æ˜¯æ²’å¢åŠ  â†’ String() è½‰æ›å¯èƒ½å¤±æ•—
```

---

## ğŸ“‹ è«‹å›å ±çš„è³‡è¨Š

å¦‚æœæŒ‰ç…§ä»¥ä¸Šæ­¥é©Ÿé‚„æ˜¯ç„¡æ³•è§£æ±ºï¼Œè«‹æä¾›ï¼š

1. **å®Œæ•´çš„æ§åˆ¶å°æ—¥èªŒ** (é»æ“ŠæŒ‰éˆ•å¾Œçš„æ‰€æœ‰è¼¸å‡º)
2. **inspectCart() çš„è¼¸å‡º**
3. **localStorage ä¸­ somnus-cart çš„å€¼**
4. **æ˜¯å¦æœ‰ç´…è‰²éŒ¯èª¤è¨Šæ¯**
5. **æŒ‰éˆ•æ˜¯å¦æœ‰ hover æ•ˆæœ**

---

## ğŸ¯ å¿«é€Ÿæ¸¬è©¦è…³æœ¬

**åœ¨æ§åˆ¶å°ä¸€æ¬¡æ€§åŸ·è¡Œå®Œæ•´æ¸¬è©¦ï¼š**
```javascript
console.log("ğŸ§ª Starting diagnostic...");
console.log("Step 1: Inspect current cart");
inspectCart();
console.log("\nStep 2: Emergency add to cart");
emergencyAddToCart();
setTimeout(() => {
    console.log("\nStep 3: Inspect after adding");
    inspectCart();
    console.log("\nStep 4: Toggle cart drawer");
    toggleCart();
}, 1000);
```

è¤‡è£½ä¸Šé¢çš„ä»£ç¢¼ï¼Œè²¼åˆ°æ§åˆ¶å°ï¼ŒæŒ‰ Enterï¼Œç­‰ 2 ç§’å¾ŒæŸ¥çœ‹çµæœã€‚

---

**æœ€å¾Œæ›´æ–°ï¼š** 2026-01-31 17:47
**è¨ºæ–·ç³»çµ±ç‰ˆæœ¬ï¼š** v2.0 (å®Œæ•´è¿½è¹¤)
